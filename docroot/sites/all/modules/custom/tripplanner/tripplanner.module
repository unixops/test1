<?php
/**
* @file
* A block .
*/
?>

<?php
/**
 * Implements hook_menu().  Register the tripplanner autocomplete callback function
 */
function tripplanner_menu()
{

	$menu['tripplaner_from/autocomplete'] = array(
    'page callback' => '_tripplaner_from_autocomplete',
    'access arguments' => array('access content'),
    'type' => MENU_CALLBACK
  );
	return $menu;
}
/**
* Implements hook_block_info().
*/
function tripplanner_block_info() {
  $blocks['tripplanner'] = array(
    'info' => t('Tripplanner'), //The name that will appear in the block list.
    'cache' => DRUPAL_CACHE_PER_ROLE, //Default
  );
  return $blocks;
}

/**
 * Implements hook_block_view().
 */
 function tripplanner_block_view($delta = '') {
  switch($delta){
    case 'tripplanner':
      $block['subject'] = '';
      if(user_access('access content')){
   $block['content']=drupal_get_form('tripplanner_form');
      }
  
  return $block;
  }
 }
/**
 * Implements hook_form().  Register a new form
 */
 function tripplanner_form($form, &$form_state) {
  $form = array();

  $form['from'] = array(
    '#title' => t('From'),
    '#type' => 'textfield',
  	'#size' => 30,
    '#autocomplete_path' => 'tripplaner_from/autocomplete',
    );

  $form['submit'] = array(
    '#type' => 'submit',
    '#value' => 'Submit',
  );
  // Get the path to the module
$path = drupal_get_path('module', 'tripplanner');
// Attach the CSS and JS to the form
$form['#attached'] = array
(
//	'css' => array
//	(
//		'type' => 'file',
//		'data' => $path . '/form_theme.css',
//	),
	'js' => array
	(
		'type' => 'file',
		'data' => $path . '/tripplanner.js',
	),
);
  return $form;
}

/**
 * Implements the autocomplete callback().  Register a theme function
 */
function _tripplaner_from_autocomplete($string) {
	// here is where we look for and return the auto complete choices based on the users input

// just some fake code to see if the hook is working	
	$matches = array();
 $matches[0] = 'a';
 $matches[1] = 'b';
  $matches[2] = 'c';
 
  // return for JS
  drupal_json_output($matches);
}
/**
 * Implements hook_theme().  Register a theme function
 */

function tripplanner_theme()
{
	return array
	(
		'tripplanner_form' => array
		(
			'render element' => 'form' // we just pass the whole form
		),
	);
}

/**
 * Implements theme_hook(). Perform a theme function
 */

function theme_tripplanner_form($vars) {
	
	$form=$vars['form']; // our form is passed in $vars
	
	// Here we add the markup for the overall trip planner block
  $output = '<div class="feature-box roundCorners" id="mytrip">

<h2 class="tp-logo"><span></span></h2>';
 // now we use drupal_render to turn the form elements into HTML and add it the output buffer
  $output .= drupal_render($form['from']);
  $output .= drupal_render($form['submit']);
 
  // Finially, we need to render the Drupal "magic fields" using a different function 
  $output .= drupal_render_children($form);
  
  //Close the markup
  $output .= '</div>';
  // return the finsihed HTML
  return $output;
}